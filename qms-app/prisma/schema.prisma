// Enhanced Quilt Management System - Prisma Schema
// This schema defines the complete data model for intelligent quilt inventory management

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for type safety
enum Season {
  WINTER
  SPRING_AUTUMN
  SUMMER
}

enum QuiltStatus {
  AVAILABLE
  IN_USE
  MAINTENANCE
  STORAGE
}

enum UsageType {
  REGULAR
  GUEST
  SPECIAL_OCCASION
  SEASONAL_ROTATION
}

// Core Quilt Model
model Quilt {
  id          String   @id @default(cuid())
  itemNumber  Int      @unique @map("item_number")
  groupId     Int?     @map("group_id")
  
  // Basic Information
  name        String
  season      Season
  
  // Physical Specifications
  lengthCm    Int      @map("length_cm")
  widthCm     Int      @map("width_cm")
  weightGrams Int      @map("weight_grams")
  
  // Material Composition
  fillMaterial     String  @map("fill_material")
  materialDetails  String? @map("material_details")
  color           String
  
  // Brand and Purchase Info
  brand        String?
  purchaseDate DateTime? @map("purchase_date")
  
  // Storage and Location
  location        String
  packagingInfo   String? @map("packaging_info")
  
  // Status and Metadata
  currentStatus QuiltStatus @default(AVAILABLE) @map("current_status")
  notes         String?
  
  // Image and Media
  imageUrl      String? @map("image_url")
  thumbnailUrl  String? @map("thumbnail_url")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relationships
  usagePeriods    UsagePeriod[]
  currentUsage    CurrentUsage?
  maintenanceLog  MaintenanceRecord[]
  
  @@map("quilts")
  @@index([season])
  @@index([currentStatus])
  @@index([location])
  @@index([brand])
  @@index([weightGrams])
  @@index([createdAt])
  @@index([updatedAt])
  @@index([season, currentStatus])
  @@index([currentStatus, location])
  @@index([brand, season])
  @@index([itemNumber, currentStatus])
}

// Usage Period Tracking
model UsagePeriod {
  id        String   @id @default(cuid())
  quiltId   String   @map("quilt_id")
  
  // Usage Period
  startDate DateTime @map("start_date")
  endDate   DateTime? @map("end_date")
  
  // Usage Context
  seasonUsed String?  @map("season_used")
  usageType  UsageType @default(REGULAR) @map("usage_type")
  notes      String?
  
  // Calculated fields
  durationDays Int? @map("duration_days")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relationships
  quilt Quilt @relation(fields: [quiltId], references: [id], onDelete: Cascade)
  
  @@map("usage_periods")
  @@index([quiltId])
  @@index([startDate])
  @@index([endDate])
  @@index([seasonUsed])
  @@index([usageType])
  @@index([createdAt])
  @@index([quiltId, startDate])
  @@index([startDate, endDate])
  @@index([seasonUsed, usageType])
}

// Current Usage Tracking
model CurrentUsage {
  id               String    @id @default(cuid())
  quiltId          String    @unique @map("quilt_id")
  
  // Current Usage Details
  startedAt        DateTime  @map("started_at")
  expectedEndDate  DateTime? @map("expected_end_date")
  usageType        UsageType @default(REGULAR) @map("usage_type")
  notes            String?
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  // Relationships
  quilt Quilt @relation(fields: [quiltId], references: [id], onDelete: Cascade)
  
  @@map("current_usage")
}

// Seasonal Recommendations Configuration
model SeasonalRecommendation {
  id          String   @id @default(cuid())
  season      Season
  
  // Recommendation Criteria
  minWeight   Int      @map("min_weight")
  maxWeight   Int      @map("max_weight")
  materials   String @map("recommended_materials") // JSON string for SQLite compatibility
  
  // Usage Guidelines
  description String
  priority    Int      @default(0)
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("seasonal_recommendations")
  @@index([season])
}

// Maintenance and Care Tracking
model MaintenanceRecord {
  id          String   @id @default(cuid())
  quiltId     String   @map("quilt_id")
  
  // Maintenance Details
  type        String   // wash, repair, storage_prep, etc.
  description String
  performedAt DateTime @map("performed_at")
  cost        Float?
  
  // Next Maintenance
  nextDueDate DateTime? @map("next_due_date")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  
  // Relationships
  quilt Quilt @relation(fields: [quiltId], references: [id], onDelete: Cascade)
  
  @@map("maintenance_records")
  @@index([quiltId])
  @@index([performedAt])
  @@index([type])
}

// User Management (for future multi-user support)
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  
  // Authentication
  hashedPassword String? @map("hashed_password")
  
  // Profile
  preferences Json?
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("users")
}

// System Settings and Configuration
model SystemSetting {
  id    String @id @default(cuid())
  key   String @unique
  value String
  
  // Metadata
  description String?
  category    String?
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  @@map("system_settings")
  @@index([category])
}

// Analytics and Insights (for future reporting)
model UsageAnalytics {
  id     String   @id @default(cuid())
  date   DateTime
  
  // Daily Metrics
  totalQuiltsInUse    Int @map("total_quilts_in_use")
  totalQuiltsAvailable Int @map("total_quilts_available")
  newUsageStarted     Int @map("new_usage_started")
  usageEnded          Int @map("usage_ended")
  
  // Seasonal Metrics
  winterQuiltsActive  Int @map("winter_quilts_active")
  springAutumnActive  Int @map("spring_autumn_active")
  summerQuiltsActive  Int @map("summer_quilts_active")
  
  // Timestamps
  createdAt DateTime @default(now()) @map("created_at")
  
  @@map("usage_analytics")
  @@unique([date])
  @@index([date])
}
