# 实施任务列表

## Phase 2.1 - 快速改进（1-2天）

- [x] 1. UI布局优化
  - [x] 1.1 移除被子列表页面右上角的批量操作按钮
    - 修改 `src/app/quilts/page.tsx`，隐藏或移除批量操作按钮
    - 保留批量操作功能代码，以备后用
    - _需求: 1.1_

  - [x] 1.2 优化列表表头样式
    - 将表头文字设置为粗体：`font-bold`
    - 将表头文字设置为居中对齐：`text-center`
    - 测试不同屏幕尺寸下的显示效果
    - _需求: 1.2, 1.3_

  - [x] 1.3 在Grid视图卡片中添加被子图片显示
    - 修改 `src/components/quilts/QuiltCard.tsx` 或Grid视图代码
    - 添加图片显示区域（aspect-square）
    - 无图片时显示占位图标
    - _需求: 1.4_

- [x] 2. 版本信息展示优化
  - [x] 2.1 从package.json读取版本号
    - 修改 `src/components/layout/AppLayout.tsx`
    - 导入 `package.json` 并读取 `version` 字段
    - 移除硬编码的日期显示
    - _需求: 2.1, 2.3_

  - [x] 2.2 添加GitHub和Vercel图标链接
    - 在版本信息区域添加GitHub图标和链接
    - 添加Vercel图标和链接
    - 确保在新标签页打开
    - _需求: 2.4, 2.5, 2.6, 2.7_

- [x] 3. 设置页面UI优化
  - [x] 3.1 实现两栏布局
    - 修改 `src/app/settings/page.tsx`
    - 使用 `grid grid-cols-1 lg:grid-cols-3` 布局
    - 左侧2/3宽度显示配置项，右侧1/3显示信息
    - _需求: 13.1, 13.2, 13.3_

  - [x] 3.2 移除数据库统计信息
    - 删除被子总数、使用记录数等统计卡片
    - 保留数据库连接状态显示
    - _需求: 13.4, 13.10_

  - [x] 3.3 优化系统信息卡片
    - 添加状态徽章（Badge组件）
    - 添加图标美化
    - 优化信息展示布局
    - _需求: 13.5_

  - [x] 3.4 实现响应式适配
    - 移动端自动切换为单栏布局
    - 测试不同屏幕尺寸
    - _需求: 13.7, 13.8_

- [x] 4. 默认语言设置为中文
  - [x] 4.1 修改语言存储默认值
    - 修改 `src/lib/language-storage.ts`
    - 将默认语言从浏览器检测改为 `'zh'`
    - 测试首次访问时的语言显示
    - _需求: 13.9, 13.10_

- [x] 5. 页面交互联动优化
  - [x] 5.1 实现仪表板双击跳转
    - 修改 `src/app/page.tsx`
    - 为"正在使用"列表添加双击事件，跳转到被子详情
    - 为"历史使用"列表添加双击事件，跳转到被子详情
    - 添加hover效果和cursor样式
    - _需求: 12.1, 12.2_

  - [x] 5.2 实现使用追踪页面双击行为
    - 修改 `src/app/usage/page.tsx`
    - 添加双击事件处理函数
    - 根据用户设置执行不同操作（编辑/查看详情/结束使用/无操作）
    - _需求: 12.3, 12.5_

  - [x] 5.3 在设置页面添加双击行为配置
    - 修改 `src/app/settings/page.tsx`
    - 添加"使用记录双击行为"配置选项
    - 使用Select组件提供4个选项
    - 保存用户偏好到数据库
    - _需求: 12.4, 12.8_

  - [x] 5.4 添加双击视觉反馈
    - 使用framer-motion添加点击动画
    - 添加高亮效果
    - 确保所有列表页面交互一致
    - _需求: 12.6, 12.7_

- [x] 6. 搜索与筛选功能增强
  - [x] 6.1 创建高级筛选面板组件
    - 创建 `src/components/quilts/AdvancedFilters.tsx`
    - 使用Popover或Sheet组件
    - 实现筛选条件UI（季节、状态、重量、尺寸、颜色、材质）
    - _需求: 10.2, 10.3, 10.4, 10.5_

  - [x] 6.2 实现筛选逻辑
    - 支持多条件组合筛选
    - 实时显示筛选结果数量
    - _需求: 10.6_

  - [x] 6.3 保存筛选条件
    - 将筛选条件保存到localStorage
    - 下次访问时自动应用
    - _需求: 10.7_

  - [ ] 6.4 实现搜索高亮
    - 在搜索结果中高亮显示匹配关键词
    - 使用mark标签或自定义样式
    - _需求: 10.8_

## Phase 2.2 - 核心功能（2-3天）

- [x] 7. 智能换被建议
  - [x] 7.1 扩展天气API获取7天预报
    - 修改 `src/app/api/weather/route.ts`
    - 添加 `daily` 参数获取7天预报数据
    - 解析并返回每日最高/最低温度
    - _需求: 4.1, 4.2_

  - [ ] 7.2 实现推荐算法
    - 创建 `src/lib/quilt-recommendation.ts`
    - 基于温度范围推荐被子类型
    - 实现温度规则（>25°夏被，15-25°春秋被，<15°冬被）

    - _需求: 4.3, 4.4, 4.5, 4.6_

  - [ ] 7.3 创建推荐展示组件
    - 创建 `src/components/dashboard/QuiltRecommendation.tsx`
    - 显示7天温度趋势
    - 显示推荐的被子列表
    - 显示推荐理由
    - _需求: 4.7, 4.8_
  - [ ] 7.4 集成到仪表板
    - 在仪表板顶部添加推荐卡片
    - 测试不同温度场景下的推荐结果

- [x] 8. 被子使用频率统计与淘汰建议
  - [x] 8.1 实现统计算法
    - 创建 `src/lib/usage-statistics.ts`
    - 计算30天、90天、365天使用次数
    - 实现淘汰建议逻辑（0次=建议淘汰，<3次=低使用率）
    - _需求: 6.1, 6.2, 6.5, 6.6_

  - [x] 8.2 创建使用频率排行榜UI
    - 在Analytics页面添加"使用频率分析"标签
    - 显示排行榜表格
    - 按使用频率排序
    - _需求: 6.3, 6.4_

  - [x] 8.3 添加筛选功能
    - 实现筛选器（全部/低使用率/建议淘汰）
    - 高亮显示建议淘汰的被子
    - _需求: 6.8_

  - [x] 8.4 在被子详情页显示统计
    - 显示该被子的使用频率
    - 显示使用趋势
    - _需求: 6.7_

- [x] 9. 被子附加图片管理
  - [x] 9.1 数据库迁移
    - 创建迁移脚本添加 `main_image` 和 `attachment_images` 字段
    - 执行迁移
    - 验证字段创建成功
    - _需求: 3.3_

  - [x] 9.2 创建图片压缩工具函数
    - 创建 `src/lib/image-utils.ts`
    - 实现图片压缩函数（限制800x600，质量80%）
    - 实现Base64编码转换
    - 添加文件类型和大小验证
    - _需求: 3.6_

  - [x] 9.3 创建图片上传组件
    - 创建 `src/components/quilts/ImageUpload.tsx`
    - 支持多图片选择
    - 实现图片预览
    - 实现拖拽排序
    - 实现删除功能
    - _需求: 3.1, 3.2, 3.5_

  - [x] 9.4 扩展tRPC路由
    - 修改 `src/server/api/routers/quilt.ts`
    - 添加 `updateImages` 方法
    - 添加 `deleteImage` 方法

  - [x] 9.5 集成到被子编辑对话框
    - 修改 `src/components/quilts/QuiltDialog.tsx`
    - 添加图片上传区域
    - 保存时上传Base64到数据库
  - [x] 9.6 在被子详情和卡片中显示图片
    - 修改详情页显示所有附加图片
    - 修改卡片显示主图片
    - _需求: 3.4_

- [ ] 10. Excel模板导入功能完善
  - [ ] 10.1 创建Excel模板生成功能
    - 创建 `src/lib/excel-template.ts`
    - 生成包含所有字段的模板
    - 添加字段说明和示例数据
    - 提供下载功能
    - _需求: 5.1, 5.2, 5.3_
  - [ ] 10.2 实现数据验证
    - 创建 `src/lib/excel-validator.ts`
    - 验证必填字段
    - 验证数据类型
    - 验证枚举值
    - 返回详细错误信息（包含行号）
    - _需求: 5.4, 5.5_
  - [ ] 10.3 创建导入预览组件
    - 修改 `src/components/import/ImportPreview.tsx`
    - 显示解析后的数据表格
    - 高亮显示错误行
    - 允许用户修正数据
    - _需求: 5.6_
  - [ ] 10.4 实现导入结果反馈
    - 显示成功导入的记录数
    - 显示失败的记录数和原因
    - _需求: 5.7, 5.8_

- [x] 11. 通知系统增强
  - [x] 11.1 创建通知数据模型
    - 创建数据库迁移脚本
    - 添加 `notifications` 表
    - 添加索引

  - [x] 11.2 实现通知规则引擎
    - 创建 `src/lib/notification-checker.ts`

    - 实现天气变化检测规则（温度变化>5°）
    - 实现维护提醒规则（连续使用>30天）
    - 实现淘汰建议规则（365天未使用）
    - _需求: 9.1, 9.2, 9.3_

  - [x] 11.3 实现实时通知检查
    - 在 `src/components/layout/AppLayout.tsx` 中添加检查逻辑
    - 应用启动时检查
    - 每小时检查一次（如果应用一直开着）

  - [ ] 11.4 扩展通知面板
    - 修改 `src/components/NotificationPanel.tsx`
    - 显示通知优先级
    - 实现点击跳转功能
    - 实现标记已读功能
    - 实现删除功能
    - _需求: 9.4, 9.5, 9.6, 9.7, 9.8_
  - [ ] 11.5 创建tRPC通知路由
    - 创建 `src/server/api/routers/notification.ts`
    - 实现获取通知列表
    - 实现标记已读
    - 实现删除通知

## Phase 2.3 - 高级功能（1-2天）

- [ ] 12. 数据可视化增强
  - [ ] 12.1 集成Recharts图表库
    - 安装 `recharts` 依赖
    - 创建图表组件目录
  - [ ] 12.2 实现使用频率柱状图
    - 创建 `src/components/analytics/UsageFrequencyChart.tsx`
    - 使用BarChart组件
    - 显示被子使用次数
    - _需求: 11.1_
  - [ ] 12.3 实现季节性使用趋势折线图
    - 创建 `src/components/analytics/SeasonalTrendChart.tsx`
    - 使用LineChart组件
    - 显示不同季节被子的使用趋势
    - _需求: 11.2_
  - [ ] 12.4 实现被子状态分布饼图
    - 创建 `src/components/analytics/StatusDistributionChart.tsx`
    - 使用PieChart组件
    - 显示不同状态的被子数量分布
    - _需求: 11.3_
  - [ ] 12.5 实现温度与被子类型关联热力图
    - 创建 `src/components/analytics/TemperatureHeatmap.tsx`
    - 显示温度与被子使用的关联
    - _需求: 11.4_
  - [ ] 12.6 添加时间范围筛选
    - 实现30天、90天、365天、全部的切换
    - 更新图表数据
    - _需求: 11.5_
  - [ ] 12.7 实现图表交互功能
    - 悬停显示详细信息
    - 点击钻取到详情
    - _需求: 11.6_
  - [ ] 12.8 添加数据洞察卡片
    - 显示关键指标
    - 显示趋势分析
    - _需求: 11.7_
  - [ ] 12.9 实现图表导出功能
    - 使用html2canvas导出为PNG
    - 添加导出按钮
    - _需求: 11.8_

- [ ] 13. 多终端PWA支持
  - [ ] 13.1 安装和配置next-pwa
    - 安装 `next-pwa` 依赖
    - 修改 `next.config.js` 配置
    - 设置开发环境禁用PWA
    - _需求: 7.1, 7.4_
  - [ ] 13.2 创建Web App Manifest
    - 创建 `public/manifest.json`
    - 定义应用名称、图标、主题色
    - _需求: 7.2, 7.3_
  - [ ] 13.3 准备PWA图标
    - 创建192x192和512x512的应用图标
    - 放置到 `public/icons/` 目录
  - [ ] 13.4 配置Service Worker缓存策略
    - 静态资源使用Cache First
    - API请求使用Network First
    - _需求: 7.4_
  - [ ] 13.5 添加安装提示
    - 使用现有的 `src/components/mobile/PWAInstallPrompt.tsx`
    - 测试安装提示显示
    - _需求: 7.5_
  - [ ] 13.6 实现离线提示
    - 在离线状态下显示友好提示
    - 阻止修改操作
    - _需求: 7.6, 7.8_
  - [ ] 13.7 优化移动端触摸交互
    - 测试触摸操作
    - 优化按钮大小和间距
    - _需求: 7.7_
  - [ ] 13.8 测试PWA功能
    - 测试安装到主屏幕
    - 测试离线访问
    - 测试不同设备和浏览器

## 测试与优化

- [ ] 14. 整体测试
  - [ ] 14.1 功能测试
    - 测试所有新增功能
    - 测试现有功能是否受影响
    - 测试不同用户场景
  - [ ] 14.2 响应式测试
    - 测试桌面端（1920x1080, 1366x768）
    - 测试平板端（768x1024）
    - 测试手机端（375x667, 414x896）
  - [ ] 14.3 浏览器兼容性测试
    - Chrome
    - Firefox
    - Safari
    - Edge
  - [ ] 14.4 性能测试
    - 测试图片加载性能
    - 测试大量数据下的列表性能
    - 测试图表渲染性能
  - [ ] 14.5 数据库测试
    - 测试Base64图片存储和读取
    - 测试数据迁移
    - 测试数据完整性

- [ ] 15. Bug修复和优化
  - [ ] 15.1 修复测试中发现的bug
  - [ ] 15.2 优化用户体验
  - [ ] 15.3 优化性能瓶颈
  - [ ] 15.4 代码审查和重构

- [ ] 16. 文档更新
  - [ ] 16.1 更新README.md
    - 添加新功能说明
    - 更新截图
  - [ ] 16.2 更新CHANGELOG.md
    - 记录所有变更
  - [ ] 16.3 更新部署文档
    - 添加数据库迁移说明
    - 更新环境变量说明

## 可选功能（待评估）

- [ ] 17. OCR标签图片导入（可选）
  - [ ] 17.1 选择OCR服务
    - 评估Tesseract.js（客户端）
    - 评估云服务（Google Vision API、Azure等）
  - [ ] 17.2 实现OCR识别
    - 集成OCR服务
    - 实现文字提取
  - [ ] 17.3 实现AI字段映射
    - 使用规则或AI模型映射字段
    - 实现结果确认界面
  - [ ] 17.4 测试和优化
    - 测试不同标签格式
    - 优化识别准确率

---

**总任务数**: 16个主要任务组，约100+个子任务
**预计工作量**: 5-7天（按你的开发速度）
**优先级**: 按Phase顺序执行，可选功能最后考虑
